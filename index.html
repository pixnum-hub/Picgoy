<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Picgoy â€“ AI Image Generator</title>

<!-- PWA manifest -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00e0ff">

<style>
:root{
  --bg:rgba(255,255,255,.18);
  --border:rgba(255,255,255,.3);
  --txt:#000;
}
body.dark{
  --bg:rgba(0,0,0,.45);
  --border:rgba(255,255,255,.15);
  --txt:#fff;
  background:#000;
}
body{
  margin:0;
  font-family:system-ui,-apple-system;
  background:linear-gradient(135deg,#00f0ff,#0077ff);
  color:var(--txt);
}
.app-frame{
  max-width:420px;
  margin:12px auto;
  padding:14px;
  border-radius:22px;
  backdrop-filter:blur(18px);
  background:var(--bg);
  border:1px solid var(--border);
  position:relative;
}
h1{text-align:center;margin:8px 0 14px}
.segment{margin-bottom:16px}
.segment h3{margin:6px 0;font-size:14px;opacity:.7}

textarea,select,input[type=range]{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:1px solid var(--border);
  background:transparent;
  color:var(--txt);
  font-size:14px;
  box-sizing:border-box;
}

.segment label{
  display:block;
  font-size:12px;
  margin-top:8px;
  margin-bottom:2px;
}

.btn-row{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}

button{
  border:none;
  border-radius:12px;
  padding:8px 12px;
  background:#fff;
  cursor:pointer;
}

.toggle{
  position:absolute;
  top:10px;
  right:10px;
  width:38px;
  height:38px;
  border-radius:50%;
}

.sticky-bar{
  position:sticky;
  bottom:0;
  padding:10px;
}
.sticky-bar button{
  width:100%;
  max-width:420px;
  margin:auto;
  display:block;
  padding:16px;
  border-radius:999px;
  font-size:16px;
  background:#00e0ff;
}

.gallery{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:8px;
}
.gallery-item{
  position:relative;
}
.gallery-item img{
  width:100%;
  border-radius:14px;
  cursor:pointer;
}
.save-btn{
  position:absolute;
  bottom:4px;
  padding:2px 6px;
  border-radius:6px;
  font-size:12px;
  cursor:pointer;
}
.save-btn.save{
  right:4px;
  background:#00e0ff;
  color:#fff;
}
.save-btn.delete{
  right:50px;
  background:#ff4d4d;
  color:#fff;
}

footer{
  text-align:center;
  font-size:12px;
  opacity:.6;
  padding:14px 0 90px;
}
</style>
</head>

<body>

<div class="app-frame">
<button class="toggle" onclick="toggleDark()">ðŸŒ™</button>
<h1>Picgoy</h1>

<!-- PROMPT -->
<div class="segment">
<h3>Enter Prompt</h3>
<textarea id="prompt" rows="3" placeholder="a car in jungle, photorealistic"></textarea>
</div>

<!-- PRESETS -->
<div class="segment">
<h3>Presets</h3>
<div class="btn-row">
<button onclick="togglePreset('photorealistic')">Photorealistic</button>
<button onclick="togglePreset('cinematic lighting')">Cinematic</button>
<button onclick="togglePreset('anime style')">Anime</button>
<button onclick="togglePreset('fantasy art')">Fantasy</button>
<button onclick="togglePreset('ultra detailed')">Ultra Detail</button>
</div>
</div>

<!-- STYLES -->
<div class="segment">
<h3>Styles</h3>
<div class="btn-row">
<button onclick="toggleStyle('ambient occlusion')">AO</button>
<button onclick="toggleStyle('hyperrealistic')">Hyperreal</button>
<button onclick="toggleStyle('high octane render')">Octane</button>
<button onclick="toggleStyle('dramatic shadows')">Shadows</button>
<button onclick="toggleStyle('studio lighting')">Studio</button>
</div>
</div>

<!-- STYLE WEIGHT SLIDERS -->
<div class="segment">
<h3>Style Weight</h3>
<label>AO Intensity: <span id="aoVal">50</span></label>
<input type="range" id="aoSlider" min="0" max="100" value="50" oninput="document.getElementById('aoVal').innerText=this.value">
<label>Exposure Strength: <span id="expVal">50</span></label>
<input type="range" id="expSlider" min="0" max="100" value="50" oninput="document.getElementById('expVal').innerText=this.value">
</div>

<!-- ASPECT RATIO -->
<div class="segment">
<h3>Aspect Ratio</h3>
<select id="ratio">
<option value="1:1">1:1 (Square)</option>
<option value="16:9">16:9 (Landscape)</option>
<option value="9:16">9:16 (Portrait)</option>
<option value="4:5">4:5</option>
</select>
</div>

<!-- IMAGE SIZE -->
<div class="segment">
<h3>Image Size</h3>
<select id="imgSize">
<option value="384">Small (384px)</option>
<option value="512" selected>Medium (512px)</option>
<option value="768">Large (768px)</option>
<option value="1024">XL (1024px)</option>
</select>
</div>

<!-- OUTPUT -->
<div class="segment">
<h3>Generated Image</h3>
<img id="output" style="width:100%;border-radius:16px;display:none">
</div>

<!-- GALLERY -->
<div class="segment">
<h3>Image Gallery</h3>
<div class="gallery" id="gallery"></div>
</div>

</div>

<!-- Sticky Generate Button -->
<div class="sticky-bar">
<button onclick="generate()">Generate Image</button>
</div>

<!-- Install PWA Button -->
<button id="installBtn" style="position:fixed;bottom:80px;right:10px;padding:10px;border-radius:12px;background:#00e0ff;color:#fff;display:none;">Install Picgoy</button>

<footer>Â© Manik Roy 2025. All Rights Reserved.</footer>

<script>
let presets=[], styles=[];

// Dark mode toggle
function toggleDark(){
  document.body.classList.toggle('dark');
}

// Toggle preset ON/OFF
function togglePreset(p){
  if(presets.includes(p)){
    presets = presets.filter(x=>x!==p);
  } else {
    presets.push(p);
    checkConflicts();
  }
  updatePrompt();
}

// Toggle style ON/OFF
function toggleStyle(s){
  if(styles.includes(s)){
    styles = styles.filter(x=>x!==s);
  } else {
    styles.push(s);
    checkConflicts();
  }
  updatePrompt();
}

// Update prompt without overwriting manual text
function updatePrompt(){
  const base = document.getElementById("prompt").value.split(",").map(t=>t.trim()).filter(t=>t.length>0);
  const combined = Array.from(new Set([...base, ...presets, ...styles]));
  document.getElementById("prompt").value = combined.join(", ");
}

// Conflict detection
function checkConflicts(){
  if(styles.includes('hyperrealistic') && styles.includes('minimal')){
    alert("Conflict detected: 'hyperrealistic' + 'minimal'");
  }
}

// Aspect ratio + size calculation
function calculateSize(ratio,base){
  let w=base,h=base;
  if(ratio==="16:9"){w=base;h=Math.round(base*9/16);}
  if(ratio==="9:16"){h=base;w=Math.round(base*9/16);}
  if(ratio==="4:5"){w=base;h=Math.round(base*5/4);}
  return {w,h};
}

// Generate image
function generate(){
  const basePrompt=document.getElementById("prompt").value.trim();
  if(!basePrompt){alert("Enter a prompt");return;}

  const full=[basePrompt,...presets,...styles].join(", ");
  const ratio=document.getElementById("ratio").value;
  const base=parseInt(document.getElementById("imgSize").value);
  const {w,h}=calculateSize(ratio,base);

  const ao=document.getElementById("aoSlider").value;
  const exp=document.getElementById("expSlider").value;

  const url=`https://image.pollinations.ai/prompt/${encodeURIComponent(full)}?width=${w}&height=${h}`;

  const img=document.getElementById("output");
  img.src=url;
  img.style.display="block";
  img.onload=()=>addToGallery(url);
}

// Add image to gallery with save and delete buttons
function addToGallery(src){
  const g=document.getElementById("gallery");
  const container=document.createElement("div");
  container.className='gallery-item';

  const im=document.createElement("img");
  im.src=src;
  im.onclick=()=>window.open(src,"_blank");

  const saveBtn=document.createElement("button");
  saveBtn.innerText="Save";
  saveBtn.className="save-btn save";
  saveBtn.onclick=(e)=>{
    e.stopPropagation();
    const a=document.createElement('a');
    a.href=src;
    a.download="Picgoy.png";
    a.click();
  };

  const delBtn=document.createElement("button");
  delBtn.innerText="Delete";
  delBtn.className="save-btn delete";
  delBtn.onclick=(e)=>{
    e.stopPropagation();
    container.remove();
  };

  container.appendChild(im);
  container.appendChild(saveBtn);
  container.appendChild(delBtn);
  g.prepend(container);
}

// PWA Install button
let deferredPrompt;
const installBtn = document.getElementById('installBtn');

window.addEventListener('beforeinstallprompt', (e)=>{
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = 'block';
});

installBtn.addEventListener('click', async ()=>{
  installBtn.style.display = 'none';
  deferredPrompt.prompt();
  deferredPrompt = null;
});

// Register service worker
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js')
    .then(()=>console.log('Service Worker Registered'))
    .catch(err=>console.log('SW registration failed:', err));
}
</script>

</body>
</html>
